{% extends "web/app_base.html" %}
{% load static %}

{% block main %}
<div class="workflow-detail__header">
  <div class="mr-auto">
    <h3>{{ template.name }}</h3>
    <p><small>{{ template.description }}</small></p>
  </div>

  <a
    class="button button--sm button--tertiary"
    href="{% url 'teams:detail' team.id %}">
    Go back
  </a>

  <vr></vr>

  {% comment %} TODO: Enable adding to existing projects {% endcomment %}
  {% comment %} <div
    data-controller='popover'
    data-popover-dont-hide-body-value="{{ dont_hide_body }}"
  >
    <button
      id="templates-add"
      data-popover-target="trigger"
      class="button button--sm button--outline"
      data-action="popover#trigger"
    >
      Add to project
    </button>
    <div data-popover-target="body" class="popover-body max-w-lg card card--sm"> 
      <form method="post">
        {% csrf_token %}

        {{ form }}

        <button type="submit" name="submit" value="add" class="button button--sm button--outline">Continue</button>
      </form>
    </div>
  </div> {% endcomment %}

  <div data-popover-target="body" class="popover-body max-w-lg card card--sm"> 
    <form method="post">
      {% csrf_token %}

      {{ form }}

      <button type="submit" name="submit" value="add" class="button button--success w-full">Continue</button>
    </form>
  </div>

  <form method="post">
    {% csrf_token %}
    <button type="submit" name="submit" value="create" class="button button--sm">Create new project</button>
  </form>
</div>

<div class="flex items-center gap-4 border-b border-gray pad">
  {% for integration in template.project.integration_set.all %}
    <div data-controller="tooltip">
      <img class="h-12 w-12" src="{% static integration.icon %}" title="{{ integration.name }}" />
      <span data-tooltip-target="body">{{ integration.display_kind }}</span>
    </div>
  {% endfor %}
</div>

{% with request.GET.dashboard_id|default:template.project.dashboard_set.first.id|add:"0" as dashboard_id %}
  {% if template.project.dashboard_set.count > 1 %}
  <nav id='tabbar' class="tabbar">
    {% for dashboard in template.project.dashboard_set.all %}
    <a class="tabbar__link {% if dashboard.id == dashboard_id %} tabbar__link--active {% endif %}"
      href="?dashboard_id={{ dashboard.id }}">
      {{ dashboard.name }}
    </a>
    {% endfor %}
  </nav>
  {% endif %}
  <div class="flex flex-1 pad overflow-auto">
    <turbo-frame id="dashboard:preview" src="{% url 'dashboards:preview' dashboard_id %}">
      <div class='placeholder-scr placeholder-scr--fillscreen'>
        <i class="placeholder-scr__icon fad fa-spinner-third fa-spin"></i>
        <p class='placeholder-scr__title'>Loading preview...</p>
      </div>
    </turbo-frame>
  </div>
{% endwith %}

{% endblock %} 
