{% extends "web/base.html" %}
{% load static %}
{% load team_tags %}

{% block banner %}
  {% if team and team.warning %}
    <div class="banner banner--warning">
      <p>
        You're exceeding your row count limit.
        <a href="{% url 'teams:account' team.id %}" class="text-white font-bold underline"> Learn more <i class="fas fa-fw fa-arrow-right fa-sm"></i></a>
      </p>
    </div>
  {% endif %}

  {% if team and not team.enabled %}
    <div class="banner banner--danger">
      <p>
        You've exceeded your row count limit by over 20%, your team is
        temporarily disabled. <a href="{% url 'teams:account' team.id %}" class="text-white font-bold underline"> Learn more <i class="fas fa-fw fa-arrow-right fa-sm"></i></a>
      </p>
    </div>
  {% endif %}
{% endblock %}

{% block secondary_sidebar %}
<div class="sidebar">
  <div class="sidebar__body">
    <div class="sidebar__link">
      <a title="View your teams" href="{% url 'web:home' %}">
        <img src="{% static 'images/logo.png' %}">
      </a>
    </div>

    <li><hr></li>

    {% for user_team in request.user.teams.all %}
    <li>
      <a class="sidebar__link {% if user_team.id == team.id %}sidebar__link--active{% endif %}"
        href="{% url 'teams:detail' user_team.id %}"
        title="{{ user_team.name }}">
        {% if user_team.icon %}<img src="{{ user_team.icon.url }}" />{% else %}<span class="team_logo">{{ user_team.name|slice:1|capfirst }}</span>{% endif %}{{ user_team.name }}
      </a>
    </li>
    {% endfor %}

    <li>
      <a id="sidebar-newteam" class="sidebar__link {% if request.resolver_match.app_name == 'teams' and request.resolver_match.url_name == 'create' %}sidebar__link--active{% endif %}" title="New Team" href="{% url 'teams:create' %}">
        <i class="fas fa-fw fa-plus mr-6"></i>New Team
      </a>
    </li> 
  </div>
</div>
{% endblock %}

{% block sidebar_content %}
<li>
  <a id="heading" class="sidebar__link" href="">
    {% if team.icon %}<img src="{{ team.icon.url }}" />{% else %}<span class="team_logo">{{ team.name|slice:1 }}</span>{% endif %}
    <strong class="h3">
      {{ team.name }}
    </strong>
  </a>
</li>

<li><hr></li>

<li class="sidebar__link">
  Projects
</li>

{% for project in team.project_set.all %}
<li>
  <a
    class="sidebar__link {% if request.resolver_match.kwargs.project_id == project.id %}sidebar__link--active{% endif %}"
    href="{% url 'projects:detail' project.id %}"
  >
    <i class="far fa-fw fa-folders"></i>{{ project.name }}
  </a>
</li>
{% endfor %}

<li class="sidebar__link">
  Team
</li>

{% if request.user|is_admin_of:team %}
<li>
  <a
    class="sidebar__link {% if request.resolver_match.view_name == 'team_members:list' %}sidebar__link--active{% endif %}"
    href="{% url 'team_members:list' team.id %}"
  >
    <i class="far fa-fw fa-users"></i>Members
  </a>
</li>

<li>
  <a
    class="sidebar__link {% if request.resolver_match.app_name == 'teams' and request.resolver_match.url_name in 'account,subscription,plan,checkout' %}sidebar__link--active{% endif %}"
    href="{% url 'teams:account' team.id %}"
  >
    <i class="far fa-fw fa-wallet"></i>Billing
  </a>
</li>

<li>
  <a
    class="sidebar__link {% if request.resolver_match.view_name == 'teams:update' %}sidebar__link--active{% endif %}"
    href="{% url 'teams:update' team.id %}"
  >
    <i class="far fa-fw fa-cog"></i>Settings
  </a>
</li>
{% endif %}
{% endblock %}

{% block body %}
{% block notifications %}{% endblock %}

<section class="flex flex-col flex-1 overflow-hidden {% block app-class %}{% endblock %}">
  {% block app %}{% endblock %}
</section>
{% endblock body %}
