{% with parents=node.parents.all %}

<turbo-frame id="workflow-modal">
  {% if node.kind == "input" or node.has_enough_parents %}
  <div class="workflow-modal__section">
    <div class="workflow-modal__header">
      {% include 'nodes/name.html' %}
    </div>

    <form class="form--no-layout overflow-hidden flex-1"
          action="{% url 'nodes:update' node.id %}"
          method="post"
          {% if do_live_updates %}
          data-controller="live-update trigger"
          {% else %}
          data-controller="trigger"
          {% endif %}
          data-trigger-event-value="node-updated-{{ node.id }}"
          data-action="submit->trigger#dispatch change->tf-modal#change"
          data-tf-modal-target='form'
          id="config-form"
          data-live-update-form-value="config-form">
      <div class="workflow-detail__sidebar">
        {{ form.media }}
        {% if filters_formset %}
        {{ filters_formset.media }}
        {% endif %}
        {% if formula_columns_formset %}
        {{ formula_columns_formset.media }}
        {% endif %}
        <span data-live-update-target="loading" class="h-6 hidden"><i
             class="placeholder-scr__icon fad fa-spinner-third fa-spin"></i></span>
        {% csrf_token %}

        {% include "django/forms/default_form.html" %}
      </div>

      <div class='workflow-modal__footer'>
        <div class="flex flex-1 gap-7 pad">
          <input type='submit' class="button button--success"
                 data-controller="trigger"
                 data-action="click->tf-modal#forceClose click->trigger#dispatch"
                 data-trigger-event-value="update-workflow"
                 name='submit'
                 value='Save & Close' />
          <input type='submit'
                 class="button button--outline button--success"
                 name='submit'
                 data-controller="trigger"
                 data-action="click->tf-modal#save click->trigger#dispatch"
                 data-trigger-event-value="update-workflow"
                 value='Save & Preview' />
        </div>
      </div>
    </form>
  </div>

  <div class="workflow-modal__section">
    <div class="workflow-modal__table">
      <nav class="tabbar">
        <a class="tabbar__link {% if show_docs %} tabbar__link--active {% endif %}"
           href="{% url 'nodes:update' object.id %}?show_docs=true">
          Help
        </a>
        {% for parent in parents %}
        <a class="tabbar__link {% if preview_node_id == parent.id %} tabbar__link--active {% endif %}"
           href="{% url 'nodes:update' object.id %}?preview_node_id={{ parent.id }}">
          Input {% if parents|length > 1 %} {{ forloop.counter }} {% endif %}
        </a>
        {% endfor %}
        <a class="tabbar__link  {% if preview_node_id == object.id and not show_docs %} tabbar__link--active {% endif %}"
           href="{% url 'nodes:update' object.id %}?preview_node_id={{ object.id }}">
          Result
        </a>
      </nav>
      {% if show_docs%}
      {% include help_template %}
      {% else%}
      <turbo-frame id="workflows-grid" src="{% url 'nodes:grid' preview_node_id %}">
        <div class='placeholder-scr placeholder-scr--fillscreen'>
          <i class="placeholder-scr__icon fad fa-spinner-third fa-spin"></i>
          <p class='placeholder-scr__title'>Loading preview...</p>
        </div>
      </turbo-frame>
      {% endif %}
    </div>
    {% else %}
    <div class='workflow-detail__warning'>
      <span class='mb-12'><i class="far fa-comment-dots fa-10x"></i></span>
      <p>This node needs to be <strong>connected</strong> to more than one node before you can configure it.</p>
    </div>
  </div>
  {% endif %}
</turbo-frame>

{% endwith %}
