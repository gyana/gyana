{% extends "web/app/project_base.html" %}
{% load static %}
{% block app %}
<div class="workflow-detail__header">
  <form method="post" action="{% url 'project_dashboards:detail' project.id object.id %}" class="form mr-auto">
    {% csrf_token %}

    <input class='input__inline' id="name" type="text" name="name" value="{{ object.name }}"></input>
  </form>


  <div data-controller='popover'>
    <button data-popover-target="trigger" class="button button--outline button--sm" data-action="popover#trigger">
      {% if request.GET.mode == 'view' %}
        <i class="fas fa-eye"></i> View
      {% else %}
        <i class="fas fa-pen"></i> Edit
      {% endif %}
      <i class="fas fa-angle-up fa-rotate-180"></i>
    </button>

    <ul data-popover-target="body" class="list list--bordered" hidden style="z-index:1;margin-top:6px;width:20rem;">
      {% expr [("view", "eye"), ("edit", "pen")] as modes %}
      {% for mode in modes %}
      <li class="list__item list__item--interactive">
        <a href="?mode={{ mode.0 }}">
          <div class="flex flex-row items-center p-4">
            <div class="w-8 mr-6">
              {% if request.GET.mode|default:'edit' == mode.0 %}
                <i class="fas fa-check text-blue"></i>
              {% endif %}
            </div>
            <div class="flex flex-col">
              <h4 class='text-blue'><i class="fas fa-{{ mode.1 }}"></i> {{ mode.0|title }}</h4>
              <p class='text-black-50'>Switch dashboard to {{ mode.0 }} mode</p>
            </div>
          </div>
        </a>
      </li>
      {% endfor %}
    </ul>
  </div>

  {% if request.GET.mode != 'view' %}
    {% include 'dashboards/_add_widget.html' with choices=choices %}
  {% endif %}
  <div data-controller='popover'>
    <span 
      data-popover-target="trigger" 
      data-action="click->popover#trigger" 
      class="button button--circle button--tertiary"
    >
      <i class="far fa-fw fa-trash"></i>
    </span>
    <div data-popover-target="body" hidden class="popover-body shadow-sm">
      {% include 'dashboards/_delete.html' %}
    </div>
  </div>
</div>

<div class="flex-1 p-4 pb-0 overflow-auto">
  <turbo-frame id="widgets" src="{% url 'dashboard_widgets:list' project.id object.id %}?mode={{ request.GET.mode|default:'edit' }}" target="_top">
  </turbo-frame>
</div>
{% endblock %}

{% block page_js %}
<script src="{% static 'js/templates-bundle.js' %}"></script>
<script src="{% static "fusioncharts/fusioncharts.js" %}"></script>
<script src="{% static "fusioncharts/fusioncharts.charts.js" %}"></script>
<script src="{% static "fusioncharts/themes/fusioncharts.theme.fusion.js" %}"></script>
{% endblock %}
