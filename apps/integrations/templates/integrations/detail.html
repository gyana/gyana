{% extends "integrations/base.html" %}
{% load render_table from django_tables2 %}
{% load static %}
{% load humanize %}

{% block tab %}
<div class="pad">
  <div class="flex gap-7 mb-7">
    {% if object.kind == 'sheet' %}
    <div class="card">
      <turbo-frame id="sheets:status" src="{% url 'sheets:status' object.sheet.id %}">
        <div class='placeholder-scr placeholder-scr--fillscreen'>
          <i class="placeholder-scr__icon fad fa-spinner-third fa-spin"></i>
          <p class='placeholder-scr__title'>Loading...</p>
        </div>
      </turbo-frame>
    </div>
    {% elif object.kind == 'connector' %}
    <div class="card card--center flex-1 flex-col">
      <turbo-frame id="connectors:status" src="{% url 'connectors:status' object.connector.id %}">
        <div class='placeholder-scr placeholder-scr--fillscreen'>
          <i class="placeholder-scr__icon fad fa-spinner-third fa-spin"></i>
          <p class='placeholder-scr__title'>Loading...</p>
        </div>
      </turbo-frame>
    </div>
    {% endif %}

    <div class="card card--center flex-1 flex-col">
      <h2>{{integration.created|naturaltime}}</h2>
      <p>First created</p>
    </div>

    {% if integration.num_rows %}
    <div class="card card--center flex-1 flex-col">
      <h2>{{ integration.num_rows }}</h2>
      <p>Rows</p>
    </div>
    {% endif %}

    <div class="card card--center flex-1 flex-col">
      <h2>
        {{ integration.created_by.username }}
      </h2>
      <p>Created by</p>
    </div>
  </div>


  <div class="flex flex-col mb-7">
    <div class="flex flex-row p-7">
      <div class="mr-auto">
        <h2>Referenced</h2>
        <p>All the places this integration is used in</p>
      </div>
      <div class='flex flex-row gap-2'>
        <a href="{% url 'project_workflows:list' project.id %}" class="button">
          <i class="fas fa-fw fa-plus"></i>New workflow
        </a>
        <a href="{% url 'project_dashboards:list' project.id %}" class="button">
          <i class="fas fa-fw fa-plus"></i>New dashboard
        </a>
        {% comment %} {% include 'workflows/create_from_integration.html' %}
        {% include 'dashboards/create_from_integration.html' %} {% endcomment %}
      </div>
    </div>

    <div class="card card--none flex-1">
    {% if integration.used_in|length == 0 %}
      <div class="text-center pad pad--sm">
        <span>
          This integration is not used anywhere yet, you can create a 
          {% comment %} <form 
            method="post" 
            action="{% url 'project_workflows:create_from_integration' project.id %}"
            class="form--no-layout"
          >
            {% csrf_token %}

            <input type="hidden" name="project" value="{{ integration.project.id }}"></input>
            <input type="hidden" name="integration" value="{{ integration.id }}"></input>
            <button submit="type" class="link">
              workflow
            </button>
          </form>
          or
          <form 
            method="post" 
            action="{% url 'project_dashboards:create_from_integration' project.id %}" 
            class="form--no-layout"
          >
            {% csrf_token %}

            <input type="hidden" name="project" value="{{ integration.project.id }}"></input>
            <input type="hidden" name="integration" value="{{ integration.id }}"></input>
            <button submit="type" class="link">
              dashboard
            </button>
          </form> {% endcomment %}
          <a href="{% url 'project_workflows:list' project.id %}" class="link">
            workflow
          </a>
          or
          <a href="{% url 'project_dashboards:list' project.id %}" class="link">
            dashboard
          </a>
          .
        </span>
      </div>
      {% else %}
        {% render_table table %}
      {% endif %}
    </div>
</div>

{% endblock %}
