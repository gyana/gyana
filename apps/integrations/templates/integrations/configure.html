{% extends 'integrations/base_setup.html' %}

{% block tab %}

<div class="pad flex flex-1 justify-center items-center">
  <div class='flex flex-col flex-1 max-w-3xl'>
    <h1 class="flex items-center justify-center gap-3 mb-7">Configure import</h1>

    <div class="flex flex-1 justify-center items-center">
      <form 
        id="configure-update-form"
        method="POST"
        action="{{ request.get_full_path }}"
        {% if object.kind == 'customapi' %}data-controller="live-update"{% endif %}
        >
        <span data-live-update-target="loading" class="hidden">
          <i class="placeholder-scr__icon fad fa-spinner-third fa-spin fa-fw fa-2x"></i>
        </span>
        {% csrf_token %}

        <p class="alert mb-4">
          If you're not sure about these options, we recommend you start with the defaults and tweak them later.
          {% if object.kind == 'connector' %}
            You can also go back to the <a href="{{ object.connector.fivetran_authorization_url }}" class="link">authorization</a> page.
          {% endif %}
        </p>

        {% if object.kind == 'customapi' and object.source_obj.authorization == object.source_obj.Authorization.OAUTH2 %}
        <p class="mb-2">
          Your OAuth2 callback URL:
        </p>
        <pre class="text-xl p-2" data-to-clipboard-target='target'>{{ request.get_host}}{% url 'customapis:oauth2_callback' object.source_obj.id %}</pre>
        {% endif %}

        {% include "django/forms/default_form.html" %}

        <input type="hidden" name="submit" value="oauth2_authorize"/>

        {% if object.kind == 'customapi' and object.source_obj.authorization == object.source_obj.Authorization.OAUTH2 %}
          <button type="submit" name="submit" value="oauth2_authorize" class="button button--tertiary mt-4 w-full">
            {% if not object.source_obj.oauth2_token %}
              Authorize
            {% else %}
              Re-Authorize
            {% endif %}
          </button>
          {% if object.source_obj.oauth2_token %}
            <button type="submit" name="submit" value="submit" class="button button--success mt-4 w-full">
              Import
            </button>
          {% endif %}
        {% else %}
          <button type="submit" name="submit" value="submit" class="button button--success mt-4 w-full">
            Import
          </button>
        {% endif %}
      </form>
    </div>
  </div>
</div>

{% endblock %}
