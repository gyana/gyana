{% extends "web/app/project_settings_base.html" %}
{% load static %}

{% block app %}

<div class="flex flex-row flex-1 overflow-hidden">
  <div class='flex flex-col flex-1 overflow-auto'>
    <h2 class="pad">Create a new integration</h2>

    <div class='flex flex-col flex-1'>
      {% if request.GET.kind %}

      {% if request.GET.kind == integration_kind.FIVETRAN and not request.GET.service %}
      <ul class="pad">
        {% for service_id, service in services.items %}
        <a
           href="{% url 'project_integrations:create' project.id %}?kind={{ integration_kind.FIVETRAN }}&service={{ service_id }}">
          <li>{{ service.name }}</li>
        </a>
        {% endfor %}
      </ul>
      {% else %}
      <div class="pad" id='create-container'>
        <form id="create-form" method="post" action="{{ request.get_full_path }}" class="form max-w-xl"
              {% if request.GET.kind == integration_kind.FIVETRAN %} data-turbo="false" {% endif %}>
          {% csrf_token %}

          {% include "django/forms/default_form.html" %}

          <p>It may take a moment to upload your file. To keep the upload going, stay within the app.</p>
          <button type="submit" class="button button--success">Create</button>
        </form>
      </div>
      {% endif %}

      {% else %}
      <div class="flex flex-col flex-1 gap-7 pad">
        <h3>First-party</h3>
        <div class="flex flex-1 flex-wrap gap-7">
          <a class="card card--inline card--square"
             href="{% url 'project_integrations:create' project.id %}?kind={{ integration_kind.GOOGLE_SHEETS }}">
            <div class="flex flex-col flex-1 items-center">
              <i class="fab fa-fw fa-google fa-3x mb-4 flex-1"></i>
              <span class="flex-1">
                Google Sheets
              </span>
            </div>
          </a>
          <a class="card card--inline card--square"
             href="{% url 'project_integrations:create' project.id %}?kind={{ integration_kind.CSV }}">
            <div class="flex flex-col flex-1 items-center">
              <i class="fas fa-fw fa-file-csv fa-3x mb-4 flex-1"></i>
              <span class="flex-1">
                CSV
              </span>
            </div>
          </a>
        </div>

        <h3>Thrid-party</h3>
        <div class="flex flex-1 flex-wrap gap-7">
          {% for service_id, service in services.items %}
          <a class="card card--inline card--square"
             href="{% url 'project_integrations:create' project.id %}?kind={{ integration_kind.FIVETRAN }}&service={{ service_id }}">
            <div class="flex-1">
              <img style="height:4.2rem;" src="{% static 'images/integrations/fivetran/'|add:service_id|add:'.svg' %}"
                   alt="{{ service.name }}" />
            </div>
            <span class="flex-1">{{ service.name }}</span>
          </a>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>
  </div>

  {% if request.GET.kind == integration_kind.GOOGLE_SHEETS %}
  <div class='flex flex-shrink-0 h-full'>
    {% include 'integrations/guides/sheets_guide.html' %}
  </div>
  {% endif %}
  {% if request.GET.kind == integration_kind.FIVETRAN %}
  <div class='flex flex-shrink-0 h-full'>
    {% include 'integrations/guides/fivetran_guide.html' with service=services|dict_key:request.GET.service %}
  </div>
  {% endif %}
</div>

{% endblock %}
