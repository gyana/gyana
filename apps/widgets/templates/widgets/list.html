{% load static %}

<div class="widgets" data-controller="tf-modal" data-open-on-param>
  {% if request.GET.mode == 'view' %}
  <header class="flex w-full justify-between mb-7">
    <div class="flex flex-col justify-center self-start">
      <p>{{ project.team.name }}</p>
      <h1>{{ dashboard.name }}</h1>
    </div>

    {% if not project.team.plan.custom_branding %}
      <p class="self-end">Powered by <a href="/" class="link">Gyana</a></p>
    {% endif %}
  </header>
  {% endif %}
  
  <div
    class="widgets__canvas"
    style="--background-color:#{{ dashboard.background_color }};"
  >
    <div
      id="dashboard-widget-container"
      class="{% if request.GET.mode != 'view' %}widgets__grid{%endif%}"
      data-controller="widget-list"
      style="
        min-width:{{ dashboard.width }}px;
        min-height:{{ dashboard.height }}px;
        --grid-size:{{ dashboard.grid_size }}px;
      "
    >
      {% for object in object_list %}
      {% include 'widgets/widget_component.html' %}
      {% empty %}
      {% if request.GET.mode != 'view' %}
      <div id='dashboard-widget-placeholder' class="w-full p-2">
        <div class="widget-card">
          <div class='placeholder-scr placeholder-scr--fillscreen'>
            <i class="placeholder-scr__icon far fa-map-marker-question fa-2x"></i>
            <p class='placeholder-scr__title mb-2'>This dashboard needs some widgets!</p>

            {% include 'dashboards/_add_widget.html' with choices=choices categories=categories %}
          </div>
        </div>
      </div>
      {% endif %}
      {% endfor %}
    </div>
  </div>
  {% comment %}
  The modal needs to be below the container because otherwise the
  updated output turbo-stream would update the chart inside the modal.
  {% endcomment %}
  <div data-tf-modal-target="modal" class="tf-modal hidden">
    <div class="card card--none card--modal flex-col flex-1 overflow-auto">
      <turbo-frame 
        id="widget-modal"
        data-tf-modal-target="turboFrame"
        {% if modal_item %}
          src="{% url "dashboard_widgets:update" project.id dashboard.id modal_item%}"
        {% endif %}
      >
        <div class='placeholder-scr placeholder-scr--fillscreen'>
          <i class="placeholder-scr__icon fad fa-spinner-third fa-spin fa-2x"></i>
        </div>
      </turbo-frame>
    </div>
  </div>
  {% include 'components/modal_closing_warning.html' %}
</div>
