{% load static %}

<turbo-frame id="widget-modal">  
  {{ form.media.js }}
  <div class="flex items-center gap-4 mb-4 flex-shrink-0">
    <h1>{{ object.name }}</h1>
  </div>

  <div class="flex flex-wrap mb-4 h-full">
    <div class="w-1/2">
      <h3>Config</h3>
      <form 
        data-controller="live-update" 
        method="post"
        action="{% url 'dashboard_widgets:update' project.id dashboard.id object.id %}" 
        class="form"
        data-tf-modal-target='form'
        data-action="change->tf-modal#change"
      >  
        <div class="absolute top-0 right-0">
          <button 
            class="tf-modal__close" 
            type="submit"
            formnovalidate
            name="close"
            value="close"
            data-action="click->tf-modal#close keydown@window->tf-modal#onInput"
          >
            <i class="fal fa-times fa-2x"></i>
          </button>
        </div>
        <div class="h-6">
          <span data-live-update-target="loading" class="hidden"><i
              class="placeholder-scr__icon fad fa-spinner-third fa-spin"></i></span>
        </div>
        {% csrf_token %}

        {% include "django/forms/default_form.html" %}

        {% if values_formset %}
        <fieldset>
          <label>Add values</label>
          {% include "components/formset.html" with formset=values_formset %}
        </fieldset>
        {% endif %}

        {% if filters_formset %}
        <fieldset>
          <label>Add filters</label>
          {% include "components/formset.html" with formset=filters_formset %}
        </fieldset>
        {% endif %}
        <div class="flex flex-1 gap-7">
          <input 
            type="submit" 
            name="submit" 
            value="Save & Close" 
            class="button button--green" 
            data-action="click->tf-modal#close"
          ></input>
          <input type="submit" name="submit" value="Save & Preview" class="button button--outline button--green"></input>
        </div>
      </form>
    </div>
    <div class="w-1/2 h-full overflow-y-auto">
      {% if widget.is_valid %}
      <turbo-frame id="widgets-output-{{ widget.id }}" src="{% url 'dashboard_widgets:output' project.id dashboard.id object.id %}">
        <div class='placeholder-scr placeholder-scr--fillscreen'>
          <i class="placeholder-scr__icon fad fa-spinner-third fa-spin"></i>
          <p class='placeholder-scr__title'>Loading widget...</p>
        </div>
      </turbo-frame>
      {% else %}
      <div class='flex flex-col items-center justify-center' style="min-height:16rem;">
        <i class="far fa-lightbulb-exclamation mb-1 fa-2x"></i>
        <p>This widget needs to be configured</p>
      </div>
      {% endif %}
    </div>
  </div>
</turbo-frame>
