{% load waffle_tags %}

{% comment %} 
IMPORTANT: Any style/layout changs here should also be made to
apps/dashboards/templates/dashboards/preview.html to reflect the changes in
preview mode.
{% endcomment %}
<gy-widget id="widget-{{ object.id }}">
  <div
    class="h-full w-full"
    data-id="{{ object.id }}"
    data-x="{{ object.x }}"
    data-y="{{ object.y }}"
    data-width="{{ object.width }}"
    data-height="{{ object.height }}"
    data-grid-size="{{ dashboard.grid_size }}"
  >
    <div class="widget-card h-full">
      <div class="widget-card__visual {% if object.page.dashboard.show_widget_border %}widget-card__visual--border{% endif %}">
        
        {% include 'widgets/_widget_title.html' %}

        <turbo-frame 
          id="widgets-output-{{ object.id }}"
          src="{% url 'dashboard_widgets:output' project.id dashboard.id object.id %}?mode={{ request.GET.mode|default:"edit" }}"
          style="display: flex; flex: 1 1 0%; min-height: 0;overflow: auto;"
        >
          <div class='placeholder-scr placeholder-scr--fillscreen'>
            <i class="placeholder-scr__icon fad fa-spinner-third fa-spin"></i>
            <p class='placeholder-scr__title'>Loading widget...</p>
          </div>
        </turbo-frame>
      </div>

      {% if not request.GET.mode or request.GET.mode == "edit" %}
      <div class='widget-card__commands'>
        {% if object.kind != "text" %}
        <button  
          data-controller="tooltip"
          data-action="click->tf-modal#open"
          id="widget-update-{{ object.id }}"  
          data-item="{{ object.id }}"
          data-src="{% url "dashboard_widgets:update" project.id dashboard.id object.pk %}"
        >
          <i class="fas fa-fw fa-edit"></i>
          <span data-tooltip-target="body">Edit</span>
        </button>

          {% flag "beta" %}
          <button  
            data-controller="tooltip"
            data-action="click->tf-modal#open"
            id="widget-update-{{ object.id }}"  
            data-item="{{ object.id }}"
            data-src="{% url "dashboard_widgets:update" project.id dashboard.id object.pk %}?show_style=true"
          >
            <i class="fas fa-fw fa-paint-brush"></i>
            <span data-tooltip-target="body">Change style</span>
          </button>
          {% endflag %}
        {% endif %}

        <form
          data-controller="tooltip"
          method='post'
          action="{% url 'dashboard_widgets:detail' project.id dashboard.id object.pk %}"
        >
          {% csrf_token %}
          <button id="widget-duplicate-{{ object.id }}" type='submit' data-loading-false>
            <i class="fas fa-fw fa-copy"></i>
          </button>
          <span data-tooltip-target="body">Duplicate</span>
        </form>

        <form
          data-controller="tooltip"
          method="post"
          action="{% url 'dashboard_widgets:delete' project.id dashboard.id object.id %}">
          {% csrf_token %}

          <button id="widget-delete-{{ object.id }}" type='submit'>
            <i class="fas fa-fw fa-trash cursor-pointer"></i>
          </button>
          <span data-tooltip-target="body">Delete</span>
        </form>
      </div>
      {% endif %}
    </div>
  </div>
</gy-widget>
