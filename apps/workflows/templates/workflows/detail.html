{% extends "web/app/project_base.html" %}
{% load static %}

{% block app-class%}workflow-detail{% endblock %}

{% block app %}
<div class="workflow-detail__header">
  <turbo-frame id="workflow-name">
    <form method="post" action="{% url 'project_workflows:detail' project.id object.id %}" class="form">
      {% csrf_token %}

      <input class='input__inline' id="name" type="text" name="name" value="{{ object.name }}"></input>
    </form>
  </turbo-frame>
  <div data-controller='event-refresh' data-event-refresh-event-value='workflow-run' class='mr-auto'>
    <turbo-frame id="workflow-last-run" src="{% url 'workflows:last_run' object.id %}"
                 data-event-refresh-target="turboFrame">
    </turbo-frame>
  </div>
  <div data-controller='popover'>
    <span
          data-popover-target="trigger"
          data-action="click->popover#trigger"
          class="button button--circle button--tertiary cursor-pointer">
      <i class="far fa-fw fa-trash"></i>
    </span>
    <div data-popover-target="body" hidden class="popover-body shadow-sm">
      {% include 'workflows/_delete.html' %}
    </div>
  </div>
</div>

<div data-controller="tf-modal" class="flex flex-1 overflow-hidden">
  <div data-tf-modal-target="modal" class="tf-modal hidden">
    <div class="card card--none flex-col h-full">
      <div class="absolute top-0 right-0">
        <button class="tf-modal__close" data-action="click->tf-modal#close keydown@window->tf-modal#onInput">
          <i class="fal fa-times fa-2x"></i>
        </button>
      </div>

      <turbo-frame id="workflow-modal" data-tf-modal-target="turboFrame">
        <div class='placeholder-scr placeholder-scr--fillscreen'>
          <i class="placeholder-scr__icon fad fa-spinner-third fa-spin fa-3x"></i>
        </div>
      </turbo-frame>
    </div>
    <div data-tf-modal-target='closingWarning' class='tf-modal flex items-center justify-center hidden'>
      <div class='card card--sm card--inline flex flex-col'>
        <h3>Be careful!</h3>
        <p class="mb-7">You have unsaved changes that will be lost on closing!</p>
        <div class='flex flex-row gap-7'>
          <button class='button button--success button--sm flex-1' data-action="click->tf-modal#closeWarning">
            Stay
          </button>
          <button class='button button--danger button--outline button--sm flex-1'
                  data-action="click->tf-modal#forceClose click->tf-modal#closeWarning">
            Close Anyway
          </button>
        </div>
      </div>
    </div>
  </div>

  <dnd-flow class='w-full' workflowId="{{ object.id }}"></dnd-flow>
</div>
{{ nodes|json_script:'nodes' }}

<script src="{% static 'js/workflow-bundle.js' %}"></script>
<link rel="stylesheet" href="{% static 'css/workflow.css' %}" />
{% endblock %}
