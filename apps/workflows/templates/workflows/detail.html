{% extends "web/app/project_base.html" %}
{% load static %}

{% block app-class %}workflow-detail{% endblock %}

{% block app %}
<div class="workflow-detail__header">
  <div
    data-controller="popover"
    data-placement="bottom-start"
    data-theme="popover-menu"
  >
    <button class="button button--circle button--tertiary">
      <i class="fas fa-fw fa-ellipsis-h"></i>
    </button>

    <template data-popover-target="body">
      <form 
        method="POST"
        action="{% url "workflows:duplicate" object.id %}"
        class="form--no-layout"
      >
        {% csrf_token %}

        <button
          type='submit'
          class="list__item list__item--interactive w-full"
          id="workflows-duplicate-{{ object.id }}"
          data-controller="tooltip"
          data-loading-false
        >
          Duplicate
        </button>
      </form>

      <a
        class="list__item list__item--interactive w-full"
        href="{% url 'project_workflows:delete' project.id object.id %}"
      >
        Delete
      </a>
    </template>
  </div>

  <turbo-frame id="workflow-name">
    <form method="post" action="{% url 'project_workflows:detail' project.id object.id %}" class="form">
      {% csrf_token %}

      <input
        class="input__inline"
        id="name"
        type="text"
        name="name"
        value="{{ object.name }}"
        onBlur="this.form.requestSubmit();"
       />
    </form>
  </turbo-frame>
  
  <div
    data-controller="workflow-last-run"
    data-workflow-last-run-src-value="{% url 'workflows:last_run' object.id %}"
    class="mr-auto"
  >
    <turbo-frame id="workflow-last-run">
      {% include 'workflows/last_run.html' %}
    </turbo-frame>
  </div>
</div>

<div
  class="flex flex-1 overflow-hidden"
  data-controller="tf-modal"
  data-open-on-param
>
  <div data-tf-modal-target="modal" class="tf-modal hidden" >
    <div class="card card--none card--modal flex-col flex-1">
      <turbo-frame 
        id="workflow-modal" 
        data-tf-modal-target="turboFrame"
        {% if request.GET.modal_item %}
          src="{% url "nodes:update" request.GET.modal_item %}"
        {% endif %}
      >
        <div class="placeholder-scr placeholder-scr--fillscreen">
          <i class="placeholder-scr__icon fad fa-spinner-third fa-spin fa-2x"></i>
        </div>
      </turbo-frame>
    </div>
    {% include 'components/modal_closing_warning.html' %}
  </div>

  <dnd-flow class="w-full" workflowId="{{ object.id }}"></dnd-flow>
</div>
{{ nodes|json_script:'nodes' }}

<script src="{% static 'js/workflow-bundle.js' %}"></script>
<link rel="stylesheet" href="{% static 'css/workflow.css' %}" />
{% endblock %}
